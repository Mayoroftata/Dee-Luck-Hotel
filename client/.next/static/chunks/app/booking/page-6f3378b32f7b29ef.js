(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[766],{1718:(e,r,a)=>{Promise.resolve().then(a.bind(a,7154))},2528:(e,r,a)=>{"use strict";a.d(r,{A:()=>i,AuthProvider:()=>o});var t=a(5155),l=a(2115),s=a(1117);let n=(0,l.createContext)();function o(e){let{children:r}=e,[a,o]=(0,l.useState)(null),[i,u]=(0,l.useState)(null),[d,m]=(0,l.useState)(!0),c=(0,s.m)();return(0,l.useEffect)(()=>{let e=()=>{try{let e=localStorage.getItem("token"),r=localStorage.getItem("user");e&&r&&(u(e),o(JSON.parse(r)))}catch(e){console.error("Auth initialization error:",e)}finally{m(!1)}};e();let r=r=>{("token"===r.key||"user"===r.key)&&e()};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[]),(0,t.jsxs)(n.Provider,{value:{user:a,token:i,login:(e,r)=>{o(e),u(r),localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(e))},logout:()=>{o(null),u(null),localStorage.removeItem("token"),localStorage.removeItem("user"),c.resetStore()},isAuthenticated:!!i,loading:d},children:[!d&&r," "]})}function i(){let e=(0,l.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7154:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>f});var t=a(5933),l=a(5155),s=a(2115),n=a(9694),o=a(7129);let i=o.Ik().shape({firstName:o.Yj().required("Full name is required"),lastName:o.Yj().required("Full name is required"),email:o.Yj().email("Please enter a valid email").required("Required"),phone:o.Yj().matches(/^\d{10}$/,"Phone number must be 11 digits").required("Phone number is required"),arrival:o.p6().required("Arrival date is required").min(new Date,"Arrival date must be today or later"),departure:o.p6().required("Departure date is required").min(new Date)});var u=a(5695),d=a(6112),m=a(9800),c=a(5799);let h=()=>({showToast:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";c.oR[r](e,{position:c.oR.POSITION.TOP_RIGHT})}});var p=a(2528);function g(){let e=(0,t._)(["\n  mutation CreateBooking($input: CreateBookingInput!) {\n    createBooking(input: $input) {\n      _id\n      guestFirstName\n        guestLastName\n      guestEmail\n    }\n  }\n"]);return g=function(){return e},e}let v=(0,d.J1)(g()),b=e=>{let{label:r,name:a,type:t="text",value:s,error:n,touched:o,onChange:i,onBlur:u}=e;return(0,l.jsxs)("div",{className:"w-full",children:[(0,l.jsx)("label",{className:"text-blue-900 pb-1 font-medium block",htmlFor:a,children:r}),(0,l.jsx)("input",{name:a,type:t,value:s,onChange:i,onBlur:u,className:"p-1.5 w-full border rounded-lg focus:outline-none ".concat(n&&o?"border-red-500":"border-gray-300 focus:border-blue-900")}),n&&o&&(0,l.jsx)("p",{className:"text-red-500 text-sm",children:n})]})},f=()=>{let e=(0,u.useRouter)(),r=(0,u.useSearchParams)().get("roomId"),{user:a,isAuthenticated:t}=(0,p.A)(),[o,{loading:d}]=(0,m.n)(v);console.log("user",a),(0,s.useEffect)(()=>{d||t||e.push("/login")},[t,d,e]);let c=async(a,t)=>{try{let{data:l}=await o({variables:{input:{guestFirstName:a.firstName,guestLastName:a.lastName,guestEmail:a.email,room:r,checkIn:a.arrival,checkOut:a.departure,specialRequests:""}}});h("Booking successful!","success"),t.resetForm(),e.push({pathname:"/booking-success",query:{fullname:a.fullname,email:a.email,arrival:a.arrival,departure:a.departure}})}catch(e){console.error(e),h("Booking failed. Try again.","error")}},{values:g,errors:f,touched:N,handleChange:x,handleBlur:j,handleSubmit:k}=(0,n.Wx)({initialValues:{firstName:"",lastName:"",email:"",phone:"",arrival:"",departure:""},validationSchema:i,onSubmit:c});return d?(0,l.jsx)("div",{children:"Loading..."}):(0,l.jsx)("div",{className:"justify-center flex items-center  min-h-screen bg-blue-900",children:(0,l.jsxs)("div",{className:"bg-white  w-full max-w-lg mx-6 border border-white/20 shadow rounded",children:[(0,l.jsx)("h1",{className:"text-center text-2xl font-bold text-blue-900 my-3",children:"Hotel Booking"}),(0,l.jsx)("div",{className:"px-5 pb-5 space-y-2",children:(0,l.jsxs)("form",{onSubmit:k,className:"space-y-2",children:[(0,l.jsx)(b,{label:"firstName*",name:"firstName",value:g.firstName,error:f.firstName,touched:N.firstName,onChange:x,onBlur:j}),(0,l.jsx)(b,{label:"Last Name*",name:"lastName",value:g.lastName,error:f.lastName,touched:N.lastName,onChange:x,onBlur:j}),(0,l.jsx)(b,{label:"Email address*",name:"email",type:"email",value:g.email,error:f.email,touched:N.email,onChange:x,onBlur:j}),(0,l.jsx)(b,{label:"Phone Number*",name:"phone",type:"tel",value:g.phone,error:f.phone,touched:N.phone,onChange:x,onBlur:j}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)(b,{label:"Arrival Date*",name:"arrival",type:"date",value:g.arrival,error:f.arrival,touched:N.arrival,onChange:x,onBlur:j}),(0,l.jsx)(b,{label:"Departure Date*",name:"departure",type:"date",value:g.departure,error:f.departure,touched:N.departure,onChange:x,onBlur:j})]}),(0,l.jsx)("div",{className:"pt-1",children:(0,l.jsx)("button",{type:"submit",disabled:d,className:"font-bold rounded-lg text-white w-full bg-blue-900 py-2 hover:bg-blue-800",children:d?"Booking...":"Book now"})})]})})]})})}}},e=>{e.O(0,[799,508,206,727,441,964,358],()=>e(e.s=1718)),_N_E=e.O()}]);